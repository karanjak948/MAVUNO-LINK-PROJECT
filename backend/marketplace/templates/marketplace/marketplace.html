{% extends 'base.html' %}
{% load static %}

{% block content %}
<h2 class="mb-4 fw-bold text-success text-center">üåç Marketplace</h2>
<p class="text-muted text-center mb-5">Browse verified products and dealers you can trust.</p>

<form method="get" class="row mb-4">
    <!-- Search Box -->
    <div class="col-md-6 mb-2">
        <input type="text" name="q" class="form-control" placeholder="üîç Search products..." value="{{ query }}">
    </div>

    <!-- Category Dropdown -->
    <div class="col-md-4 mb-2">
        <select name="category" class="form-select">
            <option value="All" {% if selected_category == "All" %}selected{% endif %}>All Categories</option>
            {% for code, name in categories %}
                <option value="{{ code }}" {% if selected_category == code %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- Submit -->
    <div class="col-md-2 mb-2">
        <button type="submit" class="btn btn-success w-100">Filter</button>
    </div>
</form>


<div class="row g-4">

    {# --- Dynamic Products from DB --- #}
    {% for product in products %}
    <div class="col-md-4">
        <div class="card shadow-sm h-100 border-0 rounded-3">
            {% if product.image %}
                <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.name }}" style="height:220px; object-fit:cover;">
            {% else %}
                <img src="{% static 'images/default_product.jpg' %}" class="card-img-top" alt="No Image" style="height:220px; object-fit:cover;">
            {% endif %}

            <div class="card-body d-flex flex-column">
                <h5 class="card-title fw-bold text-success">{{ product.name }}</h5>
                <span class="badge bg-light text-dark mb-2">{{ product.category }}</span>
                <p class="card-text text-muted small">{{ product.description|truncatewords:20 }}</p>
                <p class="fw-bold fs-5 text-success mb-1">KSh {{ product.price }}</p>
                <p class="text-muted small">In Stock: {{ product.stock }}</p>
                <p class="small mb-2"><i class="bi bi-shop"></i> Sold by: <strong>{{ product.dealer.name }}</strong></p>
                <p class="small text-warning mb-3">‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ ({{ product.reviews.count }})</p>

                <div class="mt-auto">
                    <a href="{% url 'product-detail' product.id %}" class="btn btn-outline-success w-100 mb-2">View Details</a>

                    <form method="post" action="{% url 'add-to-cart' product.id %}">
                        {% csrf_token %}
                        <div class="input-group">
                            <input type="number" name="quantity" value="1" min="1" class="form-control">
                            <button type="submit" class="btn btn-success">üõí Add</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}

    {# --- Static Demo Products (9 hard-coded) --- #}

    <!-- 1. Hybrid Maize Seeds -->
    <div class="col-md-4">
        <div class="card shadow-sm h-100 border-0 rounded-3">
            <img src="{% static 'images/seeds2.jpg' %}" class="card-img-top" alt="Hybrid Maize Seeds" style="height:220px; object-fit:cover;">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title fw-bold text-success">Maize Seeds</h5>
                <span class="badge bg-light text-dark mb-2">üå± Seeds</span>
                <p class="card-text text-muted small">High-yield hybrid maize seeds resistant to drought and pests. Suitable for both small-scale and large-scale farming.</p>
                <p class="fw-bold fs-5 text-success mb-1">KSh 2,500</p>
                <p class="text-muted small">In Stock: 120</p>
                <p class="small mb-2"><i class="bi bi-shop"></i> Sold by: <strong>AgriSeeds Ltd</strong></p>
                <p class="small text-warning mb-3">‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ (45 reviews)</p>
                <div class="mt-auto">
                    <a href="#" class="btn btn-outline-success w-100 mb-2">View Details</a>
                    <button class="btn btn-success w-100">üõí Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. Organic Fertilizer -->
    <div class="col-md-4">
        <div class="card shadow-sm h-100 border-0 rounded-3">
            <img src="{% static 'images/fertilizer.png' %}" class="card-img-top" alt="Organic Fertilizer" style="height:220px; object-fit:cover;">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title fw-bold text-success">Organic Fertilizer</h5>
                <span class="badge bg-light text-dark mb-2">üå± Fertilizer</span>
                <p class="card-text text-muted small">Eco-friendly organic fertilizer that improves soil fertility and crop yields.</p>
                <p class="fw-bold fs-5 text-success mb-1">KSh 1,800</p>
                <p class="text-muted small">In Stock: 85</p>
                <p class="small mb-2"><i class="bi bi-shop"></i> Sold by: <strong>GreenFarm Ltd</strong></p>
                <p class="small text-warning mb-3">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (62 reviews)</p>
                <div class="mt-auto">
                    <a href="#" class="btn btn-outline-success w-100 mb-2">View Details</a>
                    <button class="btn btn-success w-100">üõí Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. Pesticides -->
    <div class="col-md-4">
        <div class="card shadow-sm h-100 border-0 rounded-3">
            <img src="{% static 'images/pesticide.jpg' %}" class="card-img-top" alt="Pesticides" style="height:220px; object-fit:cover;">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title fw-bold text-success">Crop Pesticides</h5>
                <span class="badge bg-light text-dark mb-2">üß™ Chemicals</span>
                <p class="card-text text-muted small">Effective pesticide for controlling common pests in maize and vegetable crops.</p>
                <p class="fw-bold fs-5 text-success mb-1">KSh 950</p>
                <p class="text-muted small">In Stock: 200</p>
                <p class="small mb-2"><i class="bi bi-shop"></i> Sold by: <strong>AgroChem Distributors</strong></p>
                <p class="small text-warning mb-3">‚≠ê‚≠ê‚≠ê‚≠ê (31 reviews)</p>
                <div class="mt-auto">
                    <a href="#" class="btn btn-outline-success w-100 mb-2">View Details</a>
                    <button class="btn btn-success w-100">üõí Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. Mini Tractor -->
    <div class="col-md-4">
        <div class="card shadow-sm h-100 border-0 rounded-3">
            <img src="{% static 'images/tractor_tyre.jpg' %}" class="card-img-top" alt="Mini Tractor" style="height:220px; object-fit:cover;">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title fw-bold text-success">Mini Tractor</h5>
                <span class="badge bg-light text-dark mb-2">üöú Machinery</span>
                <p class="card-text text-muted small">Durable and fuel-efficient mini tractor ideal for small to medium farms.</p>
                <p class="fw-bold fs-5 text-success mb-1">KSh 450,000</p>
                <p class="text-muted small">In Stock: 10</p>
                <p class="small mb-2"><i class="bi bi-shop"></i> Sold by: <strong>TractoKenya Ltd</strong></p>
                <p class="small text-warning mb-3">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (15 reviews)</p>
                <div class="mt-auto">
                    <a href="#" class="btn btn-outline-success w-100 mb-2">View Details</a>
                    <button class="btn btn-success w-100">üõí Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 5. Irrigation Kit -->
    <div class="col-md-4">
        <div class="card shadow-sm h-100 border-0 rounded-3">
            <img src="{% static 'images/irrigation_pipes1.jpg' %}" class="card-img-top" alt="Irrigation Kit" style="height:220px; object-fit:cover;">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title fw-bold text-success">Drip Irrigation Kit</h5>
                <span class="badge bg-light text-dark mb-2">üíß Irrigation</span>
                <p class="card-text text-muted small">Complete drip irrigation kit for smallholder farmers to save water and boost yields.</p>
                <p class="fw-bold fs-5 text-success mb-1">KSh 25,000</p>
                <p class="text-muted small">In Stock: 35</p>
                <p class="small mb-2"><i class="bi bi-shop"></i> Sold by: <strong>Irritech Ltd</strong></p>
                <p class="small text-warning mb-3">‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ (28 reviews)</p>
                <div class="mt-auto">
                    <a href="#" class="btn btn-outline-success w-100 mb-2">View Details</a>
                    <button class="btn btn-success w-100">üõí Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 6. Greenhouse Covers -->
    <div class="col-md-4">
        <div class="card shadow-sm h-100 border-0 rounded-3">
            <img src="{% static 'images/greenhouse.jpg' %}" class="card-img-top" alt="Greenhouse Covers" style="height:220px; object-fit:cover;">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title fw-bold text-success">Greenhouse Covers</h5>
                <span class="badge bg-light text-dark mb-2">üè° Equipment</span>
                <p class="card-text text-muted small">Durable greenhouse polythene covers that protect crops from harsh weather.</p>
                <p class="fw-bold fs-5 text-success mb-1">KSh 12,000</p>
                <p class="text-muted small">In Stock: 50</p>
                <p class="small mb-2"><i class="bi bi-shop"></i> Sold by: <strong>AgriPlastics</strong></p>
                <p class="small text-warning mb-3">‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ (18 reviews)</p>
                <div class="mt-auto">
                    <a href="#" class="btn btn-outline-success w-100 mb-2">View Details</a>
                    <button class="btn btn-success w-100">üõí Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 7. Organic Compost -->
    <div class="col-md-4">
        <div class="card shadow-sm h-100 border-0 rounded-3">
            <img src="{% static 'images/compost.jpg' %}" class="card-img-top" alt="Organic Compost" style="height:220px; object-fit:cover;">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title fw-bold text-success">Organic Compost</h5>
                <span class="badge bg-light text-dark mb-2">üå± Fertilizer</span>
                <p class="card-text text-muted small">High-quality compost made from decomposed organic matter.</p>
                <p class="fw-bold fs-5 text-success mb-1">KSh 900</p>
                <p class="text-muted small">In Stock: 150</p>
                <p class="small mb-2"><i class="bi bi-shop"></i> Sold by: <strong>EcoFarms</strong></p>
                <p class="small text-warning mb-3">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (24 reviews)</p>
                <div class="mt-auto">
                    <a href="#" class="btn btn-outline-success w-100 mb-2">View Details</a>
                    <button class="btn btn-success w-100">üõí Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 8. Animal Feed -->
    <div class="col-md-4">
        <div class="card shadow-sm h-100 border-0 rounded-3">
            <img src="{% static 'images/feed1.jpg' %}" class="card-img-top" alt="Animal Feed" style="height:220px; object-fit:cover;">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title fw-bold text-success">Animal Feed</h5>
                <span class="badge bg-light text-dark mb-2">üêÑ Feed</span>
                <p class="card-text text-muted small">Nutritious feed mix for dairy cattle to increase milk yield.</p>
                <p class="fw-bold fs-5 text-success mb-1">KSh 3,200</p>
                <p class="text-muted small">In Stock: 60</p>
                <p class="small mb-2"><i class="bi bi-shop"></i> Sold by: <strong>FarmFeeds</strong></p>
                <p class="small text-warning mb-3">‚≠ê‚≠ê‚≠ê‚≠ê (19 reviews)</p>
                <div class="mt-auto">
                    <a href="#" class="btn btn-outline-success w-100 mb-2">View Details</a>
                    <button class="btn btn-success w-100">üõí Add</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 9. Solar Water Pump -->
    <div class="col-md-4">
        <div class="card shadow-sm h-100 border-0 rounded-3">
            <img src="{% static 'images/pump.jpg' %}" class="card-img-top" alt="Solar Water Pump" style="height:220px; object-fit:cover;">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title fw-bold text-success">Solar Water Pump</h5>
                <span class="badge bg-light text-dark mb-2">‚òÄÔ∏è Energy</span>
                <p class="card-text text-muted small">Energy-efficient solar-powered pump for reliable irrigation.</p>
                <p class="fw-bold fs-5 text-success mb-1">KSh 75,000</p>
                <p class="text-muted small">In Stock: 12</p>
                <p class="small mb-2"><i class="bi bi-shop"></i> Sold by: <strong>SunAgri Ltd</strong></p>
                <p class="small text-warning mb-3">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (8 reviews)</p>
                <div class="mt-auto">
                    <a href="#" class="btn btn-outline-success w-100 mb-2">View Details</a>
                    <button class="btn btn-success w-100">üõí Add</button>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}
